<a-scene id="scene" keymap="Pause:F12,VRToggle:F11,Menu:F10,Cursor:F6,Test:-any" ctrlmap="Pause:stick, Pause:menu"
  inspector-events fog="type:exponential; color:#040f19; density:0.17" gamma="true"
  gamestate="state:Loading; states:Loading,MainMenu,Newgame,Nextlevel,Playing,Endlevel,Endgame,Pause,Recenter">

  <a-entity id="DataGroups">
    <a-datagroup id="defaults" dataset__font="font:./assets/font/8bit-msdf.json;fontImage:./assets/font/8bit.png;"
      dataset__text="|font|align:center;color:#ffffff;negate:false;side:double;"></a-datagroup>

    <a-datagroup id="pointer" dataset__attributes="class:cursor; position:0 0 -0.1"
      dataset__geometry="primitive:sphere; radius:0.006"
      dataset__material="shader:flat;color:blue;transparent:true;opacity:0.75"
      dataset__line="start: 0 -0.010 0.090; end: 0 0 0.006; color:blue"
      dataset__collider="collidesWith: ui;layer:cursor; radius: 0.006">
    </a-datagroup>

    <a-datagroup id="DefaultButton" dataset__geometry="primitive:box;depth:0.012;height:0.030;width:0.085"
      dataset__text="|defaults:|color:#000000;wrapCount:10;width:0.070;zOffset:0.007"
      dataset__material="color:#ffffff;emissive:#ffffff;emissiveIntensity:1"
      dataset__collider="layer:ui;collidesWith:cursor;shape:box">
    </a-datagroup>

    <a-datagroup id="MotionKeys"
      dataset__recenter="rup:ArrowUp; rdown:ArrowDown; rleft:ArrowLeft; rright:ArrowRight; rin:Home; rout:PageUp; rrotleft:End; rrotright:PageDown"
      dataset__rotate="rotup:w; rotdown:s; rotleft:a; rotright:d"
      dataset__shiprotate="pitchup:ArrowUp; pitchdown:ArrowDown; yawleft:ArrowLeft; yawright:ArrowRight">
    </a-datagroup>
  </a-entity>

  <a-assets timeout="30000">
    <a-mixin id="GattlerRound" scale="0.75 0.75 2" gltf-blender-part="part:flame;src:#models-gltf;findMesh:true"
      material="shader:flat;color:white"></a-mixin>
    <a-mixin id="LargeAsteroid" scale="2 2 2" gltf-blender-part="part:asteroid;src:#models-gltf;findMesh:true"
      material="shader:flat;color:black" outline="color:#6D68FF;thickness:-0.002"></a-mixin>
    <a-mixin id="SmallAsteroid" scale="1 1 1" gltf-blender-part="part:asteroid;src:#models-gltf;findMesh:true"
      material="shader:flat;color:black" outline="color:#6D68FF;thickness:-0.002"></a-mixin>
    <a-mixin id="TinyAsteroid" scale="0.50 0.50 0.50" gltf-blender-part="part:asteroid;src:#models-gltf;findMesh:true"
      material="shader:flat;color:black" outline="color:#6D68FF;thickness:-0.002"></a-mixin>
    <a-mixin id="Ufo" scale="2 2 2" gltf-blender-part="part:ufo;src:#models-gltf;findMesh:true"
      material="shader:flat;color:black" outline="color:#8B0002;thickness:-0.002"></a-mixin>
    <a-mixin id="SmallUfo" scale="0.75 0.75 0.75" gltf-blender-part="part:ufo;src:#models-gltf;findMesh:true"
      material="shader:flat;color:black" outline="color:#8B0002;thickness:-0.002"></a-mixin>

    <image id="sky" src="./assets/sky/env.png"></image>
    <image id="sky2" src="./assets/sky/env-bottomless.png"></image>
    <image id="micosmo" src="./assets/title/micosmo-icon.06e3433d.png"></image>

    <a-asset-item response-type="arraybuffer" id="track1" src="./assets/audio/Pocketmaster_-_04_-_The_Dark_Seed.ogg">
    </a-asset-item>
    <a-asset-item response-type="arraybuffer" id="track2" src="./assets/audio/Pktmstr-08-Atomic_Fessenheim_Ed.ogg">
    </a-asset-item>

    <a-asset-item id="env-gltf" src="./assets/environment/environment.gltf"></a-asset-item>
    <a-asset-item id="models-gltf" src="./assets/models.gltf"></a-asset-item>
  </a-assets>

  <!--<a-entity id="fps-counter" fps-counter="" position="0 1.337 -0.723"></a-entity>
  states="list:Loading,MainMenu,Nextlevel,Playing,Endlevel,Endgame,Pause,Resume"
  -->

  <a-entity jukebox="volume:0.05;state:off;currentTrack:0" misound__track1="src: #track1; positional: false; offset:8"
    misound__track2="src: #track2; positional: false;">
  </a-entity>

  <a-entity id="environments">
    <a-entity id="env-1" visible="false">
      <a-entity class="backLight" light="color:#040410;type:ambient"></a-entity>
      <a-entity class="keyLight"
        light="intensity:1;decay:0;shadowMapWidth:2048;shadowMapHeight:2048;shadowCameraLeft:-0.7;shadowCameraBottom:-0.7;shadowCameraRight:0.7;shadowCameraTop:0.7;shadowCameraFar:5;target:#GameBoard;castShadow:false"
        position="-0.481 1.731 0.053"></a-entity>
      <a-entity class="fillLight" position="0.485 1.2 -0.654" light="intensity:0.5;target:#GameBoard;color:#2999ff">
      </a-entity>

      <a-entity position="0 0.1 0" gltf-blender-part="part:environment-1;src:#env-gltf;findMesh:false"
        shadeless-recursive></a-entity>
    </a-entity>
  </a-entity>

  <a-entity id="SplashScreen" position="0 1.2 -0.5" visible="false">
    <a-image src="#micosmo" position="0 1.107 -0.415" scale="2.5 2 1" rotation="-0.085 0.003 0.800"></a-image>
    <a-entity position="0.057 0.350 -0.381">
      <a-entity mi__text="|defaults:|value:ASTEROIDS   IN    HYPERSPACE;width:2.1" position="0.026 0.365 0"></a-entity>
      <a-button class="ui cursor-splash" bstyle="DefaultButton" key="F1" btext="value:ENTER"
        bstate="#scene.chain.Newgame" position="0.026 0.250 0"></a-button>
      <a-entity mi__text="|defaults:|value:!! GAME    UNDER     CONSTRUCTION !!;width:1.5" position="0.026 0.170 0">
      </a-entity>
    </a-entity>
    <a-entity position="0 -0.265 -0.300">
      <a-entity position="-.25 1.2 0" scale="2 2 2" gltf-blender-part="part:ufo;src:#models-gltf;findMesh:true"
        material="shader:flat;color:black" outline="color:#8B0002;thickness:-0.002"></a-entity>
      <a-entity position="0 1.2 0" scale="2 2 2" gltf-blender-part="part:asteroid;src:#models-gltf;findMesh:true"
        material="shader:flat;color:black" outline="color:#6D68FF;thickness:-0.002"></a-entity>
      <a-entity position=".25 1.2 0" scale="2 2 2" gltf-blender-part="part:player;src:#models-gltf;findMesh:true"
        material="shader:flat;color:black" outline="color:#98FF73;thickness:-0.002"></a-entity>
      <a-entity position=".40 1.2 0" scale="2 2 2" gltf-blender-part="part:flame;src:#models-gltf;findMesh:true"
        material="shader:flat;color:black" outline="color:#81FFFC;thickness:-0.002"></a-entity>
    </a-entity>
  </a-entity>

  <a-entity id="PauseGame" position="0 1.2 -0.5" visible="false">
    <a-image src="#micosmo" position="0 1.107 -0.415" scale="2.5 2 1" rotation="-0.085 0.003 0.800"></a-image>
    <a-entity position="0.057 0.350 -0.381">
      <a-entity mi__text="|defaults:|value:ASTEROIDS   IN    HYPERSPACE;width:2.1" position="0.026 0.365 0"></a-entity>
      <a-entity mi__text="|defaults:|value: GAME    PAUSED;width:1.5" position="0.026 0.250 0">
      </a-entity>
      <a-entity position="-0.100 0.150 0">
        <a-button class="ui cursor-pause" bstyle="DefaultButton" key="F1" btext="value:Continue" bstate="#scene.return"
          position="0 0 0"></a-button>
        <a-button class="ui cursor-pause" bstyle="DefaultButton" key="F2" btext="value:Menu"
          bstate="#scene.return.MainMenu" position="0.120 0 0"></a-button>
        <a-button class="ui cursor-pause" bstyle="DefaultButton" key="F3" btext="value:Loading"
          bstate="#scene.return.Loading" position="0.240 0 0"></a-button>
      </a-entity>
    </a-entity>
  </a-entity>

  <a-entity id="GameBoard" position="0 1.2 -0.5" visible="false">
    <!--<a-sphere position="-0.2 0 0.2" scale="0.05 0.05 0.05" material="shader:standard;sphericalEnvMap:#sky"></a-sphere>
    
    -->

    <a-entity position="0 -1.1 0">
      <a-entity shadow="receive:true;cast:false" gltf-blender-part="part:receive-shadows;src:#env-gltf;findMesh:false"
        spherical-envmap="image:#sky;intensity:.5"></a-entity>
      <!--<a-entity shadow="receive:false;cast:false" gltf-blender-part="part:no-shadows;src:#env-gltf;findMesh:false"
        shadeless-recursive></a-entity>-->
    </a-entity>

    <a-entity id="MainMenu" position="0.026 0.26 0" visible="false">
      <a-button class="ui cursor-menu" bstyle="DefaultButton" key="F1" btext="value:BEGIN" bstate="#scene.chain.Newgame"
        position="0.026 0.250 0">
      </a-button>
      <a-entity id="credits" position="0.255 -0.293 0.329">
        <a-entity mi__text="|defaults:|value:MUSIC      BY      POCKETMASTER;" position="0.026 0.365 0"
          scale="0.25 0.25 0.25"></a-entity>
        <a-entity mi__text="|defaults:|value:WWW      POCKETMASTER      CH;" position="0.026 0.355 0"
          scale="0.25 0.25 0.25"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="Pools" mipool__gattler="mixin: GattlerRound; container: #Gattler; size: 10; maxSize: 20"
      mipool__lasteroid="mixin: LargeAsteroid; container: #Asteroids; size: 5; maxSize: 20"
      mipool__sasteroid="mixin: SmallAsteroid; container: #Asteroids; size: 10; maxSize: 30"
      mipool__tasteroid="mixin: TinyAsteroid; container: #Asteroids; size: 15; maxSize: 50"
      mipool__ufo="mixin: Ufo; container: #Ufos; size: 2" mipool__sufo="mixin: SmallUfo; container: #Ufos; size: 4">
    </a-entity>

    <a-entity id="Game" position="0.026 0.26 0" ticker scale="0.5 0.5 0.5" visible="false">
      <a-entity id="PlaySpace" geometry="primitive:sphere; radius:2"
        material="shader:standard; normalScale:0.25 0.25; wireframe:true; wireframe-linewidth: 0.5" playspace
        ctrlmap="rotate:leftstick, rotate:leftpad" keyMap="|MotionKeys:rotate|" position="0 1.75 -2.00">
        <a-entity id="SpaceShip" position="0 0 0" scale="2 2 2"
          gltf-blender-part="part:player;src:#models-gltf;findMesh:true" material="shader:flat;color:black"
          outline="color:#98FF73;thickness:-0.002;filter:name=player" spaceship="lives: 5"
          ctrlmap="pitchyaw:rightstick, pitchyaw:rightpad, thrust:a, thrust:x, thrust:pad, trigger:trig"
          keymap="|MotionKeys:shiprotate| thrust:+, trigger:Space, trigger:Enter ">
          <a-entity id="Thruster" position="0.001 0 0" scale="1.5 1.5 1.5"
            gltf-blender-part="part:flame;src:#models-gltf;findMesh:true" material="shader:flat;color:black"
            outline="color:#81FFFC;thickness:-0.002" visible="false"></a-entity>
        </a-entity>
        <a-entity id="Gattler"></a-entity>
        <a-entity id="Asteroids" asteroids></a-entity>
        <a-entity id="Ufos" ufos></a-entity>
      </a-entity>
    </a-entity>

  </a-entity>

  <!--<a-entity position="-0.564 1.5 0.539" camera="spectator:true;active:false;fov:50" wasd-controls look-controls rotation="-7.334 -30.149 0"></a-entity>-->
  <!-- wasd-controls="adAxis:z;wsAxis:y" have taken this out as now support keyboard recentering 
  recenter="offset: 0, 1.1, -0.2" -->
  <a-entity id="player" recenter="offset: 0 1.2 -0.5" visible="false">
    <a-entity id="player-camera" position="0 1.4 0.5" camera="active:true" look-controls>
      <a-entity id="cursor" cursor="fuseTimeout: 500; rayOrigin: mouse" position="0 0 -0.1"
        raycaster="objects: .cursor-none; interval: 0; enabled: false"
        geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.002" material="color: red; shader: flat"
        headless-controller paused="true" keymap="|MotionKeys:recenter| Recenter:r, Trigger:Space, Trigger:Enter"
        visible="false">
      </a-entity>
    </a-entity>
    <a-entity id="leftHand" controller="hand:left;touch:pointer" ctrlmap="recenter:leftgrip" visible="false">
    </a-entity>
    <a-entity id="rightHand" controller="hand:right;touch:pointer" ctrlmap="recenter:rightgrip" visible="false">
    </a-entity>
  </a-entity>

  <a-sky color="black"></a-sky>
</a-scene>